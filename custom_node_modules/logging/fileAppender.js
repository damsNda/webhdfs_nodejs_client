'use strict';
let fs = require('fs');
let path = require('path');
let format = require('date-format');
const u = require('util');

let init=function(){
	console.log("Initialisation du systeme de logs");
	const dirLogs=path.join(__dirname,'../../logs')
	
	if (!fs.existsSync(dirLogs)){
		fs.mkdirSync(dirLogs);
	}
	
	var LOG_ERASE_MODE = 'w';
	var LOG_APPEND_MODE = 'a';
	var LOG_MODE = LOG_APPEND_MODE;
	
	
	var log_file = fs.createWriteStream(path.join(dirLogs,'/app.log'), {flags : LOG_MODE});
	let log_stdout = process.stdout;
	let log_stderr = process.stderr;

	
	let pattern="dd/MM/yyyy hh:mm:ss";
let dFormat = format.asString(pattern,new Date());
log_file.write('============================================\n');
log_file.write('Start App.js at ' + dFormat + '\n');
log_file.write('============================================\n');

console.log = function(d) {
   log("INFO",d);
};
console.warn = function(d) {
   log("WARN",d);
};
console.error = function(d) {
  log("ERROR",d);
};
	
function log(loglevel,d){
 let log=loglevel+" : "+format.asString(pattern,new Date())+" "+d;
 log_file.write(u.format(log) + '\n');
 log_stderr.write(u.format(log) + '\n');
}
	
	console.log("Fin Initialisation du systeme de logs");
};

module.exports =init;